---
layout: post
type: post
title: "Porting Solr to Docker"
date: 2017-05-02 16:19:12
author: Ryan
---
After setting up Apache Solr to function as the YACS course search, I was dismayed to find that much of my progress no longer worked following the switch to Docker last semester. Docker was a fantastic step forward for the YACS team, allowing developers to much more easily get the scheduler up and running locally, and providing numerous benefits for deployment. However, the cost of Docker's strengths for me meant learning to work around yet another tool; one which did not have much well documented information on the process of integrating a search platform like Solr.

The first step of moving to Docker was to reconfigure my development environment. No longer would I be able to manually run YACS and Solr independently, assured that as long as they were running in the same directory, things would *just work*. Everything now needed to be done through Docker, which did not play well with my machine. Long story short; I cannot recommend attempting to setup Docker on a windows machine, with the possible exception of machines running windows 10. Docker CE - the version I needed for development, was only compatible with windows 10, and alternative versions of Docker simply refused to run even with hyper-v virtualization enabled. Ultimately, I decided the best course of action was to switch to development in Ubuntu (something I mentioned in my previous blog post outlining common setup errors with Docker in Linux). 

Once I had made the switch to Ubuntu and got Docker up and running with YACS, it was time to start copying over Solr related code and configuration files. This was easier said than done. Initially, as our Solr configuration was designed to run on ruby with rails, we were able to take advantage of the sunspot gem file, which streamlined the process of integrating Solr into a rails stack. Upon moving to Docker, much of this configuration had to be changed, as Solr no longer had free reign to access whatever directories and ports it needed. To get Solr working in Docker, we needed to explicitly specify to Docker which ports and directories Solr needed access to. In the process, we also needed to make sure Docker ran everything in the correct order, by specifying Solr's dependencies and what other processes depended on Solr. 

After a lot of tinkering, we eventually were able to get Solr setup in Docker with access to the dependencies it needed, such that it could reindex data and successfully perform basic search queries. However, there is still more work to be done. Some of the more advanced functionality of Solr implemented last semester is still in the process of being ported over to the Docker build. Most importantly, more experimentation needs to be done to find an effective way of copying over a custom schema (currently required to enable n-gram filtering for partial search matches) each time Docker is deployed. However, with Solr now successfully running with YACS on Docker, it is only a matter of time before the rest of the functionality is re-implemented for good :)